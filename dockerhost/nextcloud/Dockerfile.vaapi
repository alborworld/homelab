FROM nextcloud:latest

# Install VAAPI-related packages and ffmpeg
RUN apt update && \
    apt install -y --no-install-recommends \
        intel-media-va-driver \
        vainfo \
        ffmpeg && \
    rm -rf /var/lib/apt/lists/*

# Optional: Create ffmpeg wrapper that enforces VAAPI usage
RUN echo '#!/bin/bash\n\
exec /usr/bin/ffmpeg -hide_banner -hwaccel vaapi -vaapi_device /dev/dri/renderD128 "$@"' \
    > /usr/local/bin/ffmpeg && \
    chmod +x /usr/local/bin/ffmpeg