#!/bin/sh
# Weekly auto-upgrade script for Alpine LXC
# Managed by Ansible - do not edit manually
# Runs via /etc/periodic/weekly/

LOG_TAG="{{ tailscale_hostname }}-upgrade"

logger -t "$LOG_TAG" "Starting weekly upgrade"

apk update && apk upgrade

wg-quick down wg0 && wg-quick up wg0
ip rule add to 100.64.0.0/10 lookup 52 priority 5200 2>/dev/null || true
rc-service tailscale restart

logger -t "$LOG_TAG" "Weekly upgrade complete"
